# Ingress-Only Network Policy Example
# Demonstrates ingress rules for protecting a backend service
#
# Use case: A database service that should only accept connections
# from specific application pods or IP ranges

apiVersion: ztap/v1
kind: NetworkPolicy
metadata:
  name: db-ingress-only
spec:
  podSelector:
    matchLabels:
      app: postgres
  ingress:
    # Allow from application tier
    - from:
        podSelector:
          matchLabels:
            tier: application
      ports:
        - protocol: TCP
          port: 5432
    # Allow from monitoring
    - from:
        ipBlock:
          cidr: 10.100.0.0/24
      ports:
        - protocol: TCP
          port: 5432
---
# Redis cache: Accept connections from authorized services
apiVersion: ztap/v1
kind: NetworkPolicy
metadata:
  name: redis-ingress
spec:
  podSelector:
    matchLabels:
      app: redis
  ingress:
    - from:
        podSelector:
          matchLabels:
            cache-client: "true"
      ports:
        - protocol: TCP
          port: 6379
---
# SSH bastion: Only allow from corporate VPN
apiVersion: ztap/v1
kind: NetworkPolicy
metadata:
  name: bastion-ssh-access
spec:
  podSelector:
    matchLabels:
      role: bastion
  ingress:
    - from:
        ipBlock:
          cidr: 203.0.113.0/24
      ports:
        - protocol: TCP
          port: 22
